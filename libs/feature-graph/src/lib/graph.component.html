<div class="graph-container">
  @if (isLoading) {
    <div class="loading">
      <div>
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: #1a1a2e;">Loading...</p>
      </div>
    </div>
  }

  <div class="header">
    <input 
      #topicInput
      type="text" 
      [value]="topic" 
      (input)="onTopicChange($event)"
      (keyup.enter)="generateGraph()"
      [disabled]="isLoading"
      placeholder="Enter a topic...">
    <select 
      [value]="selectedImplementation()" 
      (change)="onImplementationChange($event)"
      class="implementation-selector"
      [disabled]="isLoading">
      @for (impl of implementations; track impl.value) {
        <option [value]="impl.value">{{ impl.label }}</option>
      }
    </select>
    <button (click)="generateGraph()" [disabled]="isLoading">
      {{ isLoading ? 'Generating...' : 'Generate Graph' }}
    </button>
  </div>

  @if (error) {
    <div class="error-message">
      <p>{{ error }}</p>
      <button (click)="error = null" class="close-error">×</button>
    </div>
  }

  <div class="canvas-wrapper">
    @switch (selectedImplementation()) {
      @case ('canvas') {
        <lib-graph-canvas 
          [graphData]="graphData()"
          (nodeSelected)="onNodeSelected($event)">
        </lib-graph-canvas>
      }
      @case ('d3') {
        <lib-graph-d3 
          [graphData]="graphData()"
          (nodeSelected)="onNodeSelected($event)">
        </lib-graph-d3>
      }
      @case ('cytoscape') {
        <lib-graph-cytoscape 
          [graphData]="graphData()"
          (nodeSelected)="onNodeSelected($event)">
        </lib-graph-cytoscape>
      }
      @case ('three') {
        <lib-graph-three 
          [graphData]="graphData()"
          (nodeSelected)="onNodeSelected($event)">
        </lib-graph-three>
      }
    }
    
    <div class="stats">
      <div class="stat-row">
        <span class="stat-label">Nodes:</span>
        <span class="stat-value">{{ nodeCount }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Connections:</span>
        <span class="stat-value">{{ edgeCount }}</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Est. Hours:</span>
        <span class="stat-value">{{ totalHours }}</span>
      </div>
    </div>

    @if (selectedNode) {
      <div class="panel">
        <button class="close-btn" (click)="closePanel()">×</button>
        <div class="node-details">
          <h2>{{ selectedNode.label }}</h2>
          <p>{{ selectedNode.description }}</p>
          
          <div class="detail-row">
            <span class="detail-label">Type</span>
            <span style="text-transform: capitalize">{{ selectedNode.type }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Difficulty</span>
            <span class="badge" [ngClass]="getBadgeClass(selectedNode.difficulty)">{{ selectedNode.difficulty }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Est. Time</span>
            <span>{{ selectedNode.estimatedHours }}h</span>
          </div>
          
          <button (click)="addToPath(selectedNode.id)" style="width: 100%; margin-top: 1rem;">
            Add to Learning Path
          </button>
        </div>
      </div>
    }
    
    <div class="legend">
      <h3>Node Types</h3>
      @for (item of legendItems; track item.type) {
        <div class="legend-item">
          <div class="legend-dot" [style.background]="item.color"></div>
          <span>{{ item.label }}</span>
        </div>
      }
    </div>
  </div>

</div>
