<div class="notebook-viewer-container">
  <div class="header">
    <h1>Pandas Learning Exercises</h1>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="saveProgress()" [disabled]="loading()">
        Save Progress
      </button>
      <button mat-raised-button color="accent" (click)="submitForEvaluation()" [disabled]="loading()">
        @if (loading()) {
          <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
        }
        Submit for Evaluation
      </button>
    </div>
  </div>

  <div class="messages">
    @if (error()) {
      <mat-card class="error-card">
        <mat-card-content>
          <mat-icon>error</mat-icon>
          {{ error() }}
        </mat-card-content>
      </mat-card>
    }

    @if (success()) {
      <mat-card class="success-card">
        <mat-card-content>
          <mat-icon>check_circle</mat-icon>
          {{ success() }}
        </mat-card-content>
      </mat-card>
    }
  </div>

  <div class="notebook-iframe-container">
    <iframe
      [src]="safeMarimoUrl"
      frameborder="0"
      width="100%"
      title="Marimo Notebook"
    ></iframe>
  </div>

  @if (progress()) {
    <div class="progress-info">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Your Progress</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>Completion Rate: {{ (progress()!.completionRate * 100).toFixed(0) }}%</p>
          <p>Completed Exercises: {{ progress()!.completedExercises.join(', ') || 'None' }}</p>
          @if (progress()!.lastSubmittedAt) {
            <p>
              Last Submitted: {{ progress()!.lastSubmittedAt | date:'short' }}
            </p>
          }
        </mat-card-content>
      </mat-card>
    </div>
  }
</div>
