<div class="build-progress" [class.running]="isRunning()" [class.expanded]="isExpanded()">
  <!-- Header -->
  <div class="progress-header" (click)="toggleExpanded()">
    <div class="header-left">
      @if (isRunning()) {
        <mat-spinner diameter="20" class="status-spinner"></mat-spinner>
      } @else if (status() === 'completed') {
        <mat-icon class="status-icon completed">check_circle</mat-icon>
      } @else if (status() === 'failed') {
        <mat-icon class="status-icon failed">error</mat-icon>
      } @else {
        <mat-icon class="status-icon idle">construction</mat-icon>
      }
      <span class="progress-title">
        @if (isRunning()) {
          Building Learning Path...
        } @else if (status() === 'completed') {
          Build Complete
        } @else if (status() === 'failed') {
          Build Failed
        } @else {
          Ready to Build
        }
      </span>
    </div>
    <div class="header-right">
      @if (isRunning()) {
        <span class="progress-percent">{{ currentProgress() }}%</span>
      }
      <mat-icon class="expand-icon">{{ isExpanded() ? 'expand_less' : 'expand_more' }}</mat-icon>
    </div>
  </div>

  <!-- Progress Bar -->
  @if (isRunning()) {
    <div class="progress-bar-container">
      <div class="progress-bar" [style.width.%]="currentProgress()"></div>
    </div>
  }

  <!-- Expanded Content -->
  @if (isExpanded()) {
    <div class="progress-content">
      <!-- Current Operation -->
      <div class="current-operation">
        <span class="operation-label">Current:</span>
        <span class="operation-text">{{ progressMessage() }}</span>
      </div>

      <!-- Stats -->
      @if (totalSteps() > 0) {
        <div class="stats-row">
          <div class="stat">
            <span class="stat-value">{{ completedSteps() }}</span>
            <span class="stat-label">Completed</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ totalSteps() }}</span>
            <span class="stat-label">Total</span>
          </div>
          @if (failedSteps() > 0) {
            <div class="stat failed">
              <span class="stat-value">{{ failedSteps() }}</span>
              <span class="stat-label">Failed</span>
            </div>
          }
        </div>
      }

      <!-- Error Message -->
      @if (error()) {
        <div class="error-message">
          <mat-icon>error_outline</mat-icon>
          <span>{{ error() }}</span>
        </div>
      }

      <!-- Actions -->
      <div class="actions">
        @if (!isRunning()) {
          <button
            mat-raised-button
            color="primary"
            (click)="startBuild(); $event.stopPropagation()"
          >
            <mat-icon>auto_awesome</mat-icon>
            Build Learning Path
          </button>
        } @else {
          <button
            mat-stroked-button
            color="warn"
            (click)="cancelBuild(); $event.stopPropagation()"
          >
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
        }
      </div>
    </div>
  }
</div>
