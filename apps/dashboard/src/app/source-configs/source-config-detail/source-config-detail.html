<div class="detail-container">
  <div class="detail-header">
    <h1 class="detail-title">{{ originalTitle() | titlecase }}</h1>
  </div>

  <form (ngSubmit)="onSubmit()" class="detail-form">
    <div class="detail-content">
      <app-dynamic-form
        [metaInfo]="metaInfo"
        [dynamicForm]="dynamicForm"
      />

      @if (isEditing) {
        <p class="detail-hint">
          Note: URL cannot be changed after creation. To use a different URL, create a new source.
        </p>

        <!-- Learning Paths Section -->
        <div class="paths-section">
          <h3 class="paths-title">Learning Paths</h3>

          <!-- Current linked paths -->
          <div class="linked-paths">
            @if (linkedPaths().length > 0) {
              @for (path of linkedPaths(); track path.id) {
                <div class="linked-path-chip">
                  <span class="linked-path-name">{{ path.name }}</span>
                  <button
                    type="button"
                    class="linked-path-remove"
                    (click)="onRemovePath(path.id)"
                    [disabled]="linkLoading()"
                    aria-label="Remove from path"
                  >
                    <svg viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                  </button>
                </div>
              }
            } @else {
              <p class="no-paths">Not linked to any learning paths</p>
            }
          </div>

          <!-- Add new path -->
          @if (availablePaths().length > 0) {
            <div class="add-path-row">
              <select
                class="add-path-select"
                [(ngModel)]="selectedPathToAdd"
                [ngModelOptions]="{standalone: true}"
                [disabled]="linkLoading()"
              >
                <option value="">Select a learning path...</option>
                @for (path of availablePaths(); track path.id) {
                  <option [value]="path.id">{{ path.name }}</option>
                }
              </select>
              <button
                type="button"
                class="add-path-button"
                (click)="onAddPath()"
                [disabled]="!selectedPathToAdd || linkLoading()"
              >
                @if (linkLoading()) {
                  <mat-spinner diameter="16"></mat-spinner>
                } @else {
                  Add
                }
              </button>
            </div>
          }
        </div>
      }
    </div>

    <div class="detail-actions">
      <button
        type="button"
        class="detail-button detail-button-secondary"
        (click)="onCancel()"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="detail-button detail-button-primary"
        [disabled]="!isFormValid()"
      >
        {{ isEditing ? 'Update' : 'Create' }}
      </button>
    </div>
  </form>
</div>
