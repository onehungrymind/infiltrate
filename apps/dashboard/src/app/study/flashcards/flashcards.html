<div class="flashcards-container">
  <!-- Filters -->
  <div class="filters">
    <div class="filter-group">
      <label for="pathSelect" class="filter-label">Learning Path</label>
      <select
        id="pathSelect"
        [(ngModel)]="selectedPathId"
        (ngModelChange)="onPathChange()"
        class="filter-select"
      >
        <option [ngValue]="null">All Paths</option>
        @for (path of learningPaths; track path.id) {
          <option [ngValue]="path.id">{{ path.name }}</option>
        }
      </select>
    </div>

    <div class="filter-group">
      <label class="filter-checkbox">
        <input
          type="checkbox"
          [(ngModel)]="showDueOnly"
          (ngModelChange)="onDueOnlyChange()"
        />
        <span>Due for Review Only</span>
      </label>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading cards...</p>
    </div>
  }

  <!-- Empty State -->
  @else if (cards.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
        </svg>
      </div>
      <h3>No cards available</h3>
      <p>
        @if (showDueOnly) {
          No cards are due for review. Try disabling the filter or check back later.
        } @else {
          Add some knowledge units to start studying.
        }
      </p>
    </div>
  }

  <!-- Flashcard -->
  @else {
    <div class="flashcard-wrapper">
      <!-- Progress Bar -->
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progress"></div>
      </div>

      <!-- Card -->
      <div
        class="flashcard"
        [class.flipped]="isFlipped"
        (click)="flipCard()"
      >
        <div class="card-face card-front">
          <div class="card-header">
            <span class="card-label">Question</span>
            <span class="card-mastery" [class]="currentCard?.progress?.masteryLevel || 'new'">
              {{ masteryLabel }}
            </span>
          </div>
          <div class="card-content">
            <h2 class="card-concept">{{ currentCard?.knowledgeUnit?.concept }}</h2>
            <p class="card-question">{{ currentCard?.knowledgeUnit?.question }}</p>
          </div>
          <div class="card-footer">
            <span class="flip-hint">Click to reveal answer</span>
          </div>
        </div>

        <div class="card-face card-back">
          <div class="card-header">
            <span class="card-label">Answer</span>
            @if (confidenceLabel) {
              <span class="card-confidence">{{ confidenceLabel }}</span>
            }
          </div>
          <div class="card-content card-content-scrollable">
            <p class="card-answer">{{ currentCard?.knowledgeUnit?.answer }}</p>

            @if (currentCard?.knowledgeUnit?.elaboration) {
              <div class="card-section">
                <h4>Details</h4>
                <p>{{ currentCard?.knowledgeUnit?.elaboration }}</p>
              </div>
            }

            @if (currentCard?.knowledgeUnit?.examples?.length) {
              <div class="card-section">
                <h4>Examples</h4>
                <ul>
                  @for (example of currentCard?.knowledgeUnit?.examples; track example) {
                    <li>{{ example }}</li>
                  }
                </ul>
              </div>
            }
          </div>
          <div class="card-footer">
            <span class="flip-hint">Click to flip back</span>
          </div>
        </div>
      </div>

      <!-- Rating Buttons -->
      <div class="rating-buttons">
        <button
          class="rating-btn rating-again"
          (click)="rateCard(0); $event.stopPropagation()"
          title="Press 1"
        >
          <span class="rating-label">Again</span>
          <span class="rating-key">1</span>
        </button>
        <button
          class="rating-btn rating-hard"
          (click)="rateCard(3); $event.stopPropagation()"
          title="Press 2"
        >
          <span class="rating-label">Hard</span>
          <span class="rating-key">2</span>
        </button>
        <button
          class="rating-btn rating-good"
          (click)="rateCard(4); $event.stopPropagation()"
          title="Press 3"
        >
          <span class="rating-label">Good</span>
          <span class="rating-key">3</span>
        </button>
        <button
          class="rating-btn rating-easy"
          (click)="rateCard(5); $event.stopPropagation()"
          title="Press 4"
        >
          <span class="rating-label">Easy</span>
          <span class="rating-key">4</span>
        </button>
      </div>

      <!-- Navigation -->
      <div class="navigation">
        <button
          class="nav-btn"
          (click)="previousCard()"
          [disabled]="currentIndex === 0"
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
          </svg>
          Previous
        </button>

        <span class="nav-counter">
          {{ currentIndex + 1 }} of {{ cards.length }}
        </span>

        <button
          class="nav-btn"
          (click)="nextCard()"
          [disabled]="currentIndex === cards.length - 1"
        >
          Next
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
        </button>
      </div>

      <!-- Keyboard Hints -->
      <div class="keyboard-hints">
        <span><kbd>Space</kbd> Flip</span>
        <span><kbd>&larr;</kbd><kbd>&rarr;</kbd> Navigate</span>
        <span><kbd>1-4</kbd> Rate</span>
      </div>
    </div>
  }
</div>
